{{!-- pages/index.hbs --}} 

{{#> layouts/base title="Home | New Media Development | Artevelde University College Ghent" pathToRoot="./"

}} {{#*inline "content-block"}}

<div id="page parent">
  <div id="artwork">

  </div>


  <div class="fb-grid__row" id="child">
    <div class="fb-grid__col-xs-1 fb-grid__col-sm-1 fb-grid__col-md-1 fb-grid__col-lg-1 fb-grid__col-xl-1 fb-grid__col-1"></div>
    <div class="fb-grid__col-xs-6 fb-grid__col-sm-6 fb-grid__col-md-6 fb-grid__col-lg-6 fb-grid__col-xl-6 fb-grid__col-6">
      <h6>more like this</h6>
    </div>
    <div class="fb-grid__col-xs-2 fb-grid__col-sm-2 fb-grid__col-md-2 fb-grid__col-lg-2 fb-grid__col-xl-2 fb-grid__col-2"> </div>
    <div class="fb-grid__col-xs-3 fb-grid__col-sm-3 fb-grid__col-md-3 fb-grid__col-lg-3 fb-grid__col-xl-3 fb-grid__col-3"> </div>
  </div>

  <div id="blog">

  </div>

</div>
{{/inline}} {{#*inline "scripts-block"}}

<script>
  console.log('json is called in');

  function getUrlVars() {
      var vars = {};
      var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function (m, key, value) {
        vars[key] = value;
      });
      return vars;
    }

  function getJsonByCallbacks(url, succesHandler, errorHandler) {
    var xhr = new XMLHttpRequest();
    xhr.responseType = 'json';
    xhr.open('GET', url, true);
    xhr.onload = function () {
      if (xhr.status == 200) {
        var data = (!xhr.responseType) ? JSON.parse(response) : xhr.response;
        succesHandler && succesHandler(data)
      } else {
        errorHandler && errorHandler(`Error ${xhr.status}`);
      }
    };
    xhr.onerror = function () {

      errorHandler && errorHandler('network error');
    };
    xhr.send(null);
  }

  getJsonByCallbacks('https://api.myjson.com/bins/jftnf',
    function (data) {
      let blogData = data.articles;
      let projectsData = data.projects;
     
      console.log(blogData);
      let projectID = (getUrlVars()["project"]-1);
      console.log(projectID);
      let tempStr = '';
      let projectInfo = projectsData[projectID];
      let projectElement = document.querySelector('#artwork');
      console.log(projectInfo);
      let tag = projectInfo.tags[0];
      tempStr += 
      `
      <div class="fb-grid__row">
        <div class="fb-grid__col-xs-1 fb-grid__col-sm-1 fb-grid__col-md-1 fb-grid__col-lg-1 fb-grid__col-xl-1 fb-grid__col-1"></div>
        <div class="fb-grid__col-xs-10 fb-grid__col-sm-10 fb-grid__col-md-10 fb-grid__col-lg-10 fb-grid__col-xl-10 fb-grid__col-10">
          <div class="picText">
            <img src="${projectInfo.pictures[0]}" alt="picture of the campus">
            <h4>  ${projectInfo.projectName}</h4>
            <h5 class="date"> <a href="./profileStudent.html?profile=${projectInfo.artist}"> ${projectInfo.artist} </a> </h5>
            <p>${projectInfo.bodyText}</p>
          </div>
        </div>
        <div class="fb-grid__col-xs-1 fb-grid__col-sm-1 fb-grid__col-md-1 fb-grid__col-lg-1 fb-grid__col-xl-1 fb-grid__col-1"></div>
      </div>`;
    projectElement.innerHTML = tempStr;


      let blogElement = document.querySelector('#blog');
      //lege string aan maken
      var tempStr2 = '';
     
     
     
      let moreLikeThis = []
      console.log(projectsData)

        projectsData.forEach(function (projectsData) {
          if (projectsData.tags[0] === tag && projectsData.projectName !== projectInfo.projectName || projectsData.tags[0] === projectInfo.tags[1] && projectsData.projectName !== projectInfo.projectName || projectsData.tags[1] === projectInfo.tags[0] && projectsData.projectName !== projectInfo.projectName) {
            moreLikeThis.push(projectsData);
          } else {
            console.log('nothing found');
          }
        });

        if (moreLikeThis.length === 0 ){
          let parent = document.getElementById('parent');
          let child = document.getElementById('child');
          parent.removeChild(child);
        } else {
          console.log("there are childeren")
        }
      console.log(moreLikeThis);
      
      function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
          let j = Math.floor(Math.random() * (i + 1));
          [array[i], array[j]] = [array[j], array[i]];
        }
      }
      
      shuffleArray(moreLikeThis);
      
      let amounthToSplice = (moreLikeThis.length - 5)

      moreLikeThis.splice(4, amounthToSplice);
      console.log(moreLikeThis);
      moreLikeThis.forEach(function (moreLikeThis) {
        tempStr2 +=
          `<a href="./detailArtwork.html?project=${moreLikeThis.projectId}"> <div class="fb-grid__row margin-top blogSum">
              <div class="fb-grid__col-xs-3 fb-grid__col-sm-3 fb-grid__col-md-3 fb-grid__col-lg-3 fb-grid__col-xl-3 fb-grid__col-3">
                <img src="${moreLikeThis.pictures[0]}" alt="logo Portfolio rex" class="radius5"> </div>
                <div class="fb-grid__col-xs-1 fb-grid__col-sm-1 fb-grid__col-md-1 fb-grid__col-lg-1 fb-grid__col-xl-1 fb-grid__col-1"></div>
                <div class="fb-grid__col-xs-6 fb-grid__col-sm-6 fb-grid__col-md-6 fb-grid__col-lg-6 fb-grid__col-xl-6 fb-grid__col-6">
                <h5 class="articleName">${moreLikeThis.projectName}</h5>
                <span class="date"> ${moreLikeThis.artist}<br> </span>
                <span class="tag tagArticle"> ${moreLikeThis.tags[0]}</span>
              </div>
            </div> </a>`;
      });

      //de html in het element veranderen naar de inhoud van tempstr
      blogElement.innerHTML = tempStr2;
      //The forEach() method executes a provided function once for each array element.
  /*    for (i = 0; i < 3; ++i) {
        //projectsData.forEach(function(uitvoer) {
        //de tempstr aanvullen met de ingeladen informatie
        tempStr2 +=
           `<div class="fb-grid__row margin-top blogSum">
              <div class="fb-grid__col-xs-3 fb-grid__col-sm-3 fb-grid__col-md-3 fb-grid__col-lg-3 fb-grid__col-xl-3 fb-grid__col-3">
                <img src="${blogData[i].image}" alt="logo Portfolio rex" class="radius5"> </div>
                <div class="fb-grid__col-xs-1 fb-grid__col-sm-1 fb-grid__col-md-1 fb-grid__col-lg-1 fb-grid__col-xl-1 fb-grid__col-1"></div>
                <div class="fb-grid__col-xs-6 fb-grid__col-sm-6 fb-grid__col-md-6 fb-grid__col-lg-6 fb-grid__col-xl-6 fb-grid__col-6">
                <h5 class="articleName">${blogData[i].articleName}</h5>
                <span class="date"> ${blogData[i].date}<br> </span>
                <span class="tag tagArticle">Article</span>
              </div>
            </div>`;
      };

      //de html in het element veranderen naar de inhoud van tempstr
      blogElement.innerHTML = tempStr2;
*/
    },
    function (status) {
      console.log(status);
    }
  );
</script>
{{/inline}} {{/layouts/base}}